;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="05f3880c-3099-3350-05c0-3466cd08579f")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,561912,e=>{"use strict";var t=e.i(478902),i=e.i(389959);e.i(128328);var a=e.i(158639),s=e.i(902858),n=e.i(215261),r=e.i(898452),o=e.i(595519),l=e.i(276423),d=e.i(971131),c=e.i(962217),u=e.i(70756),m=e.i(681328),p=e.i(201461),h=e.i(636047),x=e.i(70255);function f(e,t){return e.indexOf(t)>=0}function g({gridRef:e,rows:t}){let a=(0,x.useTableEditorTableStateSnapshot)(),s=(0,i.useMemo)(()=>"windows"==(navigator?.appVersion.indexOf("Win")!==-1?"windows":navigator?.appVersion.indexOf("Mac")!==-1?"macos":"unknown")?"Control":"Command",[]);return!function(e,t=[],a=[]){let[s,n]=i.useState(),r=i=>{var s;if(!e||f(t,i.target.nodeName)||f(a,i.target.className))return;let r=(s=i).metaKey&&s.shiftKey?`Command+Shift+${s.key}`:s.metaKey?`Command+${s.key}`:s.shiftKey&&"Enter"===s.key?`Shift+${s.key}`:s.ctrlKey&&s.key?`Control+${s.key}`:s.key;e[r]&&(r.includes("+")?(i.preventDefault(),e[r](i),n(null)):(n(i.key),i.preventDefault()))},o=t=>{e&&e[t.key]&&s===t.key&&(t.preventDefault(),e[t.key](t),n(null))};i.useEffect(()=>(window.addEventListener("keydown",r),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",o)}))}({[`${s}+ArrowUp`]:t=>{if(t.stopPropagation(),a.selectedCellPosition){let t={idx:a.selectedCellPosition?.idx??0,rowIdx:0};e.current.selectCell(t)}else e.current.scrollToCell({rowIdx:Number(0)})},[`${s}+ArrowDown`]:i=>{if(i.stopPropagation(),a.selectedCellPosition){let i={idx:a.selectedCellPosition?.idx??0,rowIdx:t.length>1?t.length-1:0};e.current.selectCell(i)}else e.current.scrollToCell({rowIdx:Number(t.length)})},[`${s}+ArrowLeft`]:t=>{t.stopPropagation();let i={idx:a.gridColumns.filter(e=>e.frozen).length,rowIdx:a.selectedCellPosition?.rowIdx??0};e.current.selectCell(i)},[`${s}+ArrowRight`]:t=>{t.stopPropagation(),e.current?.selectCell({idx:a.gridColumns.length-2,rowIdx:a.selectedCellPosition?.rowIdx??0})}},["INPUT","TEXTAREA","SELECT"]),null}var b=e.i(4196),j=e.i(805303),y=e.i(425861),w=e.i(415190),v=e.i(635494),T=e.i(899850),C=e.i(3036),S=e.i(710377),N=e.i(382490),E=e.i(774803),k=e.i(201844),P=e.i(632459),R=e.i(821276),_=e.i(437893),I=e.i(837710),L=e.i(613580),D=e.i(746301),O=e.i(466472),$=e.i(205311),A=e.i(526925);let Q=[{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1000 rows"}],F=({onRowsPerPageChange:e})=>{let i=(0,h.useTableEditorStateSnapshot)();return(0,t.jsx)($.DropdownControl,{options:Q,onSelect:e,side:"top",align:"start",children:(0,t.jsx)(I.Button,{asChild:!0,type:"outline",style:{padding:"3px 10px"},children:(0,t.jsx)("span",{children:`${i.rowsPerPage} rows`})})})},M=({enableForeignRowsQuery:e=!0})=>{let{id:s}=(0,a.useParams)(),n=s?Number(s):void 0,{sorts:r}=(0,R.useTableSort)(),{filters:o}=(0,P.useTableFilter)(),{data:l}=(0,v.useSelectedProjectQuery)(),d=(0,h.useTableEditorStateSnapshot)(),m=(0,x.useTableEditorTableStateSnapshot)(),f=(0,p.useRoleImpersonationStateSnapshot)(),{data:g}=(0,w.useTableEditorQuery)({projectRef:l?.ref,connectionString:l?.connectionString,id:n}),b=(0,c.isForeignTable)(g),j=m.page,y=(0,c.isTable)(g)?g.live_rows_estimate:null,[$,Q]=(0,i.useState)(j.toString()),[M,V]=(0,i.useState)(!1),[z,U]=(0,i.useState)(!1),[B,H]=(0,i.useState)(!1),{data:K,isPending:W,isSuccess:q,isError:G,isFetching:Y,error:X}=(0,_.useTableRowsCountQuery)({projectRef:l?.ref,connectionString:l?.connectionString,tableId:m.table.id,filters:o,enforceExactCount:m.enforceExactCount,roleImpersonationState:f},{placeholderData:k.keepPreviousData,enabled:!b}),Z=K?.count??0,J=K?.is_estimate?(0,A.formatEstimatedCount)(Z):Z.toLocaleString(),ee=Math.ceil(Z/d.rowsPerPage),et=Z>0?ee:1,{data:ei,isPending:ea}=(0,u.useTableRowsQuery)({projectRef:l?.ref,connectionString:l?.connectionString,tableId:n,sorts:r,filters:o,page:m.page,limit:d.rowsPerPage,roleImpersonationState:f},{enabled:b&&e}),es=(ei?.rows??[]).length<d.rowsPerPage,en=()=>{j>1&&(m.selectedRows.size>=1?U(!0):er())},er=()=>{let e=j-1;m.setPage(e)},eo=()=>{let e=j+1;m.setPage(e)},el=e=>{let t=e>ee?ee:e;m.setPage(t||1)},ed=e=>{let t=Number(e);d.setRowsPerPage(isNaN(t)?100:t)};return((0,i.useEffect)(()=>{Q(String(j))},[j]),(0,i.useEffect)(()=>{!b&&j&&j>et&&m.setPage(et)},[b,j,et]),(0,i.useEffect)(()=>{void 0!==n&&m.setEnforceExactCount(null!==y&&y<=T.THRESHOLD_COUNT)},[n]),(0,i.useEffect)(()=>{G&&m.enforceExactCount&&X?.code===408&&m.setEnforceExactCount(!1)},[G,m.enforceExactCount,X?.code]),b)?(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(I.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(C.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:j<=1,onClick:en}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(D.Input,{size:"tiny",className:"w-10",min:1,value:$,onChange:e=>Q(e.target.value),onKeyDown:e=>{let t=Number($);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&el(t)}}),(0,t.jsx)(I.Button,{"aria-label":"Next page",icon:(0,t.jsx)(S.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:es||!e,loading:ea&&e,onClick:eo}),(0,t.jsx)(F,{onRowsPerPageChange:ed})]}):(0,t.jsxs)("div",{className:"flex items-center gap-x-4",children:[W&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(E.Loader2,{size:12,className:"animate-spin"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Loading records count..."})]}),q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(I.Button,{"aria-label":"Previous page",icon:(0,t.jsx)(C.ArrowLeft,{}),type:"outline",className:"px-1.5",disabled:j<=1||W,onClick:en}),(0,t.jsx)("p",{className:"text-xs text-foreground-light",children:"Page"}),(0,t.jsx)(D.Input,{className:"w-12",size:"tiny",min:1,max:ee,value:$,onChange:e=>Q(e.target.value),onKeyDown:e=>{let t=Number($);("Enter"===e.code||"NumpadEnter"===e.code)&&!Number.isNaN(t)&&t>=1&&t<=ee&&el(t)}}),(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:["of ",et.toLocaleString()]}),(0,t.jsx)(I.Button,{"aria-label":"Next page",icon:(0,t.jsx)(S.ArrowRight,{}),type:"outline",className:"px-1.5",disabled:j>=ee||W,onClick:()=>{j<ee&&(m.selectedRows.size>=1?V(!0):eo())}}),(0,t.jsx)(F,{onRowsPerPageChange:ed})]}),!b&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsxs)("p",{className:"text-xs text-foreground-light",children:[`${J} ${0===Z||Z>1?"records":"record"}`," ",K.is_estimate?"(estimated)":""]}),K.is_estimate&&(0,t.jsxs)(L.Tooltip,{children:[(0,t.jsx)(L.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(I.Button,{size:"tiny",type:"text",className:"px-1.5",loading:Y,icon:(0,t.jsx)(N.HelpCircle,{}),onClick:()=>{null===y||Z>T.THRESHOLD_COUNT?H(!0):m.setEnforceExactCount(!0)}})}),(0,t.jsxs)(L.TooltipContent,{side:"top",className:"w-72",children:["This is an estimated value as your table has more than"," ",T.THRESHOLD_COUNT.toLocaleString()," rows. ",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-brand",children:"Click to retrieve the exact count of the table."})]})]})]})]}),G&&(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Error fetching records count. Please refresh the page."}),(0,t.jsx)(O.default,{visible:z,title:"Confirm moving to previous page",confirmLabel:"Confirm",onCancel:()=>U(!1),onConfirm:()=>{er(),U(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(O.default,{visible:M,title:"Confirm moving to next page",confirmLabel:"Confirm",onCancel:()=>V(!1),onConfirm:()=>{eo(),V(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"The currently selected lines will be deselected, do you want to proceed?"})}),(0,t.jsx)(O.default,{variant:"warning",visible:B,title:"Confirm to fetch exact count for table",confirmLabel:"Retrieve exact count",onCancel:()=>H(!1),onConfirm:()=>{m.setEnforceExactCount(!0),H(!1)},children:(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:null===y?`If your table has a row count of greater than ${T.THRESHOLD_COUNT.toLocaleString()} rows,
          retrieving the exact count of the table may cause performance issues on your database.`:`Your table has a row count of greater than ${T.THRESHOLD_COUNT.toLocaleString()} rows, and
          retrieving the exact count of the table may cause performance issues on your database.`})})]})},V=({enableForeignRowsQuery:e=!0})=>{let{id:i}=(0,a.useParams)(),s=i?Number(i):void 0,{data:n}=(0,v.useSelectedProjectQuery)(),[r,o]=(0,b.useQueryState)("view",b.parseAsString.withDefault("data")),{data:l}=(0,w.useTableEditorQuery)({projectRef:n?.ref,connectionString:n?.connectionString,id:s}),d=(0,c.isViewLike)(l),u=(0,c.isTableLike)(l);return(0,t.jsxs)(j.GridFooter,{children:["data"===r&&(0,t.jsx)(M,{enableForeignRowsQuery:e}),(0,t.jsx)("div",{className:"ml-auto flex items-center gap-x-2",children:(d||u)&&(0,t.jsx)(y.default,{width:75,options:["definition","data"],activeOption:r,borderOverride:"border",onClickOption:o})})]})};var z=e.i(591385),U=e.i(991435),B=e.i(19583),H=e.i(687256),K=e.i(471994),W=e.i(311827),q=e.i(162082),G=e.i(265735),Y=e.i(323150),X=e.i(843778),Z=e.i(108151),J=e.i(356003),ee=e.i(355901),et=e.i(328675),ei=e.i(513826),ea=e.i(790819),es=e.i(478145),en=e.i(10429),er=e.i(567558),eo=e.i(937942),el=e.i(710483);let ed=({error:e})=>{let{filters:i}=(0,P.useTableFilter)(),{sorts:a}=(0,R.useTableSort)(),s=(0,x.useTableEditorTableStateSnapshot)(),n=s.originalTable?.entity_type===W.ENTITY_TYPE.FOREIGN_TABLE&&e?.message?.includes("query vault failed"),r=i.length>0&&e?.message?.includes("invalid input syntax"),o=a.length>0&&e?.message?.includes("identify an ordering operator");return n?(0,t.jsx)(ec,{}):r?(0,t.jsx)(eu,{error:e}):o?(0,t.jsx)(em,{error:e}):(0,t.jsx)(ep,{error:e})},ec=()=>{let{ref:e}=(0,a.useParams)(),{data:i}=(0,v.useSelectedProjectQuery)(),s=i?.parent_project_ref!==void 0;return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:"Failed to retrieve rows from foreign table",children:[(0,t.jsxs)("p",{children:["The key that's used to retrieve data from your foreign table is either incorrect or missing. Verify the key in your"," ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations?category=wrapper`,children:"wrapper's settings"})," ","or in ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"}),"."]}),s&&(0,t.jsxs)("p",{children:["Note: Vault keys from the main project do not sync to branches. You may add them manually into ",(0,t.jsx)(eo.InlineLink,{href:`/project/${e}/integrations/vault/overview`,children:"Vault"})," ","if you want to query foreign tables while on a branch."]})]})},eu=({error:e})=>{let{onApplyFilters:i}=(0,P.useTableFilter)();return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:"Invalid input syntax provided in filter value(s)",children:[(0,t.jsx)("p",{className:"!mb-0",children:"Unable to retrieve results as the provided value in your filter(s) doesn't match it's column data type."}),(0,t.jsx)("p",{className:"!mb-2",children:"Verify that your filter values are correct before applying the filters again."}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(I.Button,{type:"default",onClick:()=>i([]),children:"Remove filters"})]})},em=({error:e})=>{let{sorts:i,onApplySorts:a}=(0,R.useTableSort)(),s=(e?.message??"").split("type ").pop(),n=s.includes("json")?s.toUpperCase():s;return(0,t.jsxs)(el.Admonition,{type:"warning",className:"pointer-events-auto",title:`Sorting is not supporting on ${i.length>1?"one of the selected columns":"the selected column"}`,children:[(0,t.jsxs)("p",{className:"!mb-0",children:["Unable to retrieve results as sorting is not supported on"," ",i.length>1?"one of the selected columns":"the selected column"," due to its data type. (",n,")"]}),(0,t.jsxs)("p",{className:"!mb-2",children:["Remove any sorts on columns with the data type ",n," applying the sorts again."]}),(0,t.jsxs)("p",{className:"text-sm text-foreground-lighter prose max-w-full !mb-4",children:["Error: ",(0,t.jsx)("code",{className:"text-code-inline",children:e.message})]}),(0,t.jsx)(I.Button,{type:"default",onClick:()=>a([]),children:"Remove sorts"})]})},ep=({error:e})=>{let{filters:i}=(0,P.useTableFilter)();return(0,t.jsx)(er.default,{className:"pointer-events-auto",error:e,subject:"Failed to retrieve rows from table",children:i.length>0&&(0,t.jsx)("p",{children:"Verify that the filter values are correct, as the error may stem from an incorrectly applied filter"})})};var eh=e.i(840645),ex=e.i(701275);function ef(e,i){let{show:a}=(0,eh.useContextMenu)();return(0,t.jsx)(z.Row,{...i,onContextMenu:function(e){a(e,{id:ex.ROW_CONTEXT_MENU_ID,props:{rowIdx:i.rowIdx}})}},e)}let eg=e=>e?.idx??-1,eb=(0,i.memo)((0,i.forwardRef)(({width:e,height:a,containerClass:s,gridClass:n,rowClass:r,rows:o,error:l,isDisabled:d=!1,isLoading:u,isSuccess:m,isError:f},g)=>{let b=(0,h.useTableEditorStateSnapshot)(),j=(0,x.useTableEditorTableStateSnapshot)(),{filters:y,onApplyFilters:w}=(0,P.useTableFilter)(),{data:T}=(0,G.useSelectedOrganizationQuery)(),{data:C}=(0,v.useSelectedProjectQuery)(),S=function(e){let a=(0,J.useQueryClient)(),{data:s}=(0,v.useSelectedProjectQuery)(),n=(0,x.useTableEditorTableStateSnapshot)(),r=(0,p.useGetImpersonatedRoleState)(),{mutate:o}=(0,es.useTableRowUpdateMutation)({async onMutate({projectRef:e,table:t,configuration:i,payload:s}){let n=new Set(Object.keys(i.identifiers)),r=ea.tableRowKeys.tableRows(e,{table:{id:t.id}});await a.cancelQueries({queryKey:r});let o=a.getQueriesData({queryKey:r});return a.setQueriesData({queryKey:r},e=>({rows:e?.rows.map(e=>Object.entries(e).filter(([e])=>n.has(e)).every(([e,t])=>t===i.identifiers[e])?{...e,...s}:e)??[]})),{previousRowsQueries:o}},onError(e,t,i){let{previousRowsQueries:s}=i;s.forEach(([e,t])=>{t&&a.setQueriesData({queryKey:e},t),a.invalidateQueries({queryKey:e})}),ee.toast.error(e?.message??e)}});return(0,i.useCallback)((i,a)=>{if(!s)return;let l=i[a.indexes[0]],d=e.find(e=>e.idx==l.idx),u=Object.keys(l).find(e=>l[e]!==d[e]);if(!d||!u)return;let m={[u]:l[u]},p=n.originalTable.columns?.filter(e=>(e?.enums??[]).length>0&&"array"===e.data_type.toLowerCase()).map(e=>e.name),h={};if((0,c.isTableLike)(n.originalTable)&&n.originalTable.primary_keys.forEach(e=>{let t=n.originalTable.columns.find(t=>t.name===e.name);h[e.name]=t?.format==="bytea"?(0,et.convertByteaToHex)(d[e.name]):d[e.name]}),0===Object.keys(h).length)return(0,ee.toast)("Unable to update row as table has no primary keys",{description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(ei.DocsButton,{href:`${en.DOCS_URL}/guides/database/tables#primary-keys`})})]})});o({projectRef:s.ref,connectionString:s.connectionString,table:n.originalTable,configuration:{identifiers:h},payload:m,enumArrayColumns:p,roleImpersonationState:r()})},[r,o,s,e,n.originalTable])}(o),N=(0,i.useRef)(null),E=j.page,k=j.table,R=j.originalTable?.entity_type,_=R===W.ENTITY_TYPE.FOREIGN_TABLE,L=0===(o??[]).length,{mutate:D}=(0,q.useSendEventMutation)(),{isValidFile:O,isDraggedOver:$,onDragOver:A,onFileDrop:Q}=function({enabled:e,onFileDropped:t,onTelemetryEvent:a}){let[s,n]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),l=(0,i.useCallback)(t=>{if(!e)return;let[i]=t.dataTransfer.items;i&&"file"!==i.kind||("dragover"!==t.type||s?("dragleave"===t.type||"drop"===t.type)&&(n(!1),o(!1)):(n(!0),o("text/csv"===i.type)),t.stopPropagation(),t.preventDefault())},[e,s,r]),d=(0,i.useCallback)(i=>{if(!e)return;l(i);let[s]=i.dataTransfer.files,[n]=i.dataTransfer.items;n&&"file"!==n.kind||(0,Y.flagInvalidFileImport)(s)||(t(s),a?.("import_data_dropzone_file_added"))},[e,l,t,a]);return{isValidFile:r&&s,isDraggedOver:s,onDragOver:l,onFileDrop:d}}({enabled:L&&!_,onFileDropped:e=>b.onImportData((0,U.ref)(e)),onTelemetryEvent:e=>{D({action:e,groups:{project:C?.ref??"Unknown",organization:T?.slug??"Unknown"}})}}),{data:F}=(0,K.useForeignKeyConstraintsQuery)({projectRef:C?.ref,connectionString:C?.connectionString,schema:k?.schema??void 0});return(0,t.jsxs)("div",{className:(0,X.cn)("flex flex-col relative transition-colors",s),style:{width:e||"100%",height:a||"50vh"},children:[0===(o??[]).length&&(0,t.jsxs)("div",{className:(0,X.cn)("absolute top-9 p-2 w-full z-[1] pointer-events-none",L&&$&&"border-2 border-dashed",O?"border-brand-600":"border-destructive-600"),style:{height:"calc(100% - 35px)"},onDragOver:A,onDragLeave:A,onDrop:Q,children:[u&&!d&&(0,t.jsx)(Z.GenericSkeletonLoader,{}),f&&(0,t.jsx)(ed,{error:l}),m&&(0,t.jsx)(t.Fragment,{children:E>1?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light",children:"This page does not have any data"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(I.Button,{type:"default",className:"pointer-events-auto",onClick:()=>j.setPage(1),children:"Head back to first page"})})]}):0===(y??[]).length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:$?O?"Drop your CSV file here":(0,t.jsx)("span",{className:"text-destructive",children:"Only CSV files are accepted"}):"This table is empty"}),R===W.ENTITY_TYPE.FOREIGN_TABLE?(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"This table is a foreign table. Add data to the connected source to get started."})}):!$&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 mt-4",children:[(0,t.jsx)(I.Button,{type:"default",className:"pointer-events-auto",onClick:()=>{b.onImportData(),D({action:"import_data_button_clicked",properties:{tableType:"Existing Table"},groups:{project:C?.ref??"Unknown",organization:T?.slug??"Unknown"}})},children:"Import data from CSV"}),(0,t.jsx)("p",{className:"text-xs text-foreground-light pointer-events-auto",children:"or drag and drop a CSV file here"})]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center col-span-full h-full",children:[(0,t.jsx)("p",{className:"text-sm text-light pointer-events-auto",children:"The filters applied have returned no results from this table"}),(0,t.jsx)("div",{className:"flex items-center space-x-2 mt-4",children:(0,t.jsx)(I.Button,{type:"default",className:"pointer-events-auto",onClick:()=>w([]),children:"Remove all filters"})})]})})]}),(0,t.jsx)(z.default,{ref:g,className:`${n} flex-grow`,rowClass:r,columns:j.gridColumns,rows:o??[],renderers:{renderRow:ef},rowKeyGetter:eg,selectedRows:j.selectedRows,onColumnResize:j.updateColumnSize,onRowsChange:S,onSelectedCellChange:function(e){N.current=e,j.setSelectedCellPosition({idx:e.column.idx,rowIdx:e.rowIdx})},onSelectedRowsChange:function(e){j.setSelectedRows(e)},onCellDoubleClick:e=>{var t,i;let a;return t=e.row,void((a=function(e){let{targetTableSchema:t,targetTableName:i,targetColumnName:a}=k?.columns.find(t=>t.name==e)?.foreignKey??{},s=F?.find(s=>s.source_schema===k?.schema&&s.source_table===k?.name&&s.source_columns.includes(e)&&s.target_schema===t&&s.target_table===i&&s.target_columns.includes(a??""));return void 0!==s?(0,H.formatForeignKeys)([s])[0]:void 0}((i=e.column).name))&&b.onEditForeignKeyColumnValue({foreignKey:a,row:t,column:i}))},onCellKeyDown:B.handleCopyCell})]})}));var ej=e.i(105417),ey=e.i(816467),ew=e.i(53071),ev=e.i(211570),eT=e.i(375761),eC=e.i(253214),eS=e.i(607764);let eN=({rows:e})=>{let a=(0,h.useTableEditorStateSnapshot)(),s=(0,x.useTableEditorTableStateSnapshot)(),n=(0,i.useCallback)(t=>{let i=t.props?.rowIdx;if(!s.selectedCellPosition||null==i)return;let a=e[i][s.gridColumns[s.selectedCellPosition.idx].key],n=(0,eS.formatClipboardValue)(a);(0,eT.copyToClipboard)(n),ee.toast.success("Copied cell value to clipboard")},[e,s.gridColumns,s.selectedCellPosition]),r=(0,i.useCallback)(t=>{let i=t.props?.rowIdx;if(null==i)return;let a=e[i];(0,eT.copyToClipboard)(JSON.stringify(a)),ee.toast.success("Copied row to clipboard")},[e]);return(0,t.jsxs)(eh.Menu,{id:ex.ROW_CONTEXT_MENU_ID,animation:!1,className:"!min-w-36",children:[(0,t.jsxs)(eh.Item,{onClick:n,children:[(0,t.jsx)(ey.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell"})]}),(0,t.jsxs)(eh.Item,{onClick:r,children:[(0,t.jsx)(ey.Copy,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Copy row"})]}),s.editable&&(0,t.jsx)(eC.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(eh.Item,{onClick:function(t){let i=t.props?.rowIdx;if(null==i)return;let s=e[i];a.onEditRow(s)},hidden:!s.editable,data:"edit",children:[(0,t.jsx)(ew.Edit,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),s.editable&&(0,t.jsx)(eC.DialogSectionSeparator,{className:"my-1.5"}),(0,t.jsxs)(eh.Item,{onClick:function(t){let i=t.props?.rowIdx;if(null==i)return;let s=e[i];s&&a.onDeleteRows([s])},hidden:!s.editable,data:"delete",children:[(0,t.jsx)(ev.Trash,{size:12}),(0,t.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})},eE=({title:e,children:i})=>(0,t.jsx)("div",{className:"mt-2 px-3 pb-2",children:(0,t.jsx)(el.Admonition,{type:"warning",title:e,description:i})}),ek=()=>(0,t.jsx)(eE,{title:"Cannot sort by filtered column",children:'Sorting only by columns filtered with "=" or "is" doesn\'t work on MSSQL tables. Pick a different sorting column, or add a column not in your filter.'}),eP=()=>(0,t.jsx)(eE,{title:"No valid sort column remaining",children:'All columns that can be sorted have been filtered with "=" or "is", which doesn\'t work on MSSQL tables. Remove a column from your filter to continue.'}),eR=({customHeader:e,gridProps:s,children:n})=>{let{id:r}=(0,a.useParams)(),f=r?Number(r):void 0,{data:b}=(0,v.useSelectedProjectQuery)(),j=(0,h.useTableEditorStateSnapshot)(),y=(0,x.useTableEditorTableStateSnapshot)(),w=(0,i.useRef)(null),[T,C]=(0,i.useState)(!1),{filters:S}=(0,P.useTableFilter)(),{sorts:N,onApplySorts:E}=(0,R.useTableSort)(),_=(0,p.useRoleImpersonationStateSnapshot)(),I=(0,c.isMsSqlForeignTable)(y.originalTable)?(({filters:e,sorts:t,table:i})=>{if(!(0,c.isMsSqlForeignTable)(i))return{warning:null};let a=new Set(e.filter(e=>"="===e.operator||"is"===e.operator).map(e=>e.column)),s=t.length>0&&t.every(e=>a.has(e.column));if(a.size>0&&s)return{warning:"ConflictingSort",Component:ek};let n=i.columns.length>0&&i.columns.every(e=>"json"===e.data_type||a.has(e.name));return e.length>0&&n?{warning:"NoValidSortPossible",Component:eP}:{warning:null}})({filters:S,sorts:N,table:y.originalTable}):{warning:null},L=null===I.warning,{data:D,error:O,isSuccess:$,isError:A,isPending:Q,isRefetching:F}=(0,u.useTableRowsQuery)({projectRef:b?.ref,connectionString:b?.connectionString,tableId:f,sorts:N,filters:S,page:y.page,limit:j.rowsPerPage,roleImpersonationState:_},{placeholderData:k.keepPreviousData,enabled:L,retry:(e,t)=>(t&&t.message?.includes("does not exist")&&E([]),!1)});(0,i.useEffect)(()=>{T||C(!0)},[]);let M=D?.rows??m.EMPTY_ARR;return(0,t.jsx)(o.DndProvider,{backend:l.HTML5Backend,context:window,children:(0,t.jsxs)("div",{className:"sb-grid h-full flex flex-col",children:[(0,t.jsx)(ej.Header,{customHeader:e,isRefetching:F,tableQueriesEnabled:L}),null!==I.warning&&(0,t.jsx)(I.Component,{}),n||(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eb,{ref:w,...s,rows:M,error:O,isDisabled:!L,isLoading:Q,isSuccess:$,isError:A}),(0,t.jsx)(V,{enableForeignRowsQuery:L}),(0,t.jsx)(g,{gridRef:w,rows:M})]}),T&&(0,d.createPortal)((0,t.jsx)(eN,{rows:M}),document.body)]})})};var e_=e.i(2579),eI=e.i(990510),eL=e.i(983783),eD=e.i(238944),eO=e.i(392491),e$=e.i(63519),eA=e.i(290623),eQ=e.i(565066),eF=e.i(156054),eM=e.i(896975),eV=e.i(642834),ez=e.i(487164),eU=e.i(600966),eB=e.i(887093),eH=e.i(48189);let eK=({entity:e})=>{let{ref:s}=(0,a.useParams)(),r=(0,i.useRef)(null),o=(0,i.useRef)(null),{resolvedTheme:l}=(0,eM.useTheme)(),{data:d}=(0,v.useSelectedProjectQuery)(),u=(0,eU.useViewDefinitionQuery)({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isViewLike)(e)}),m=(0,ez.useTableDefinitionQuery)({id:e?.id,projectRef:d?.ref,connectionString:d?.connectionString},{enabled:(0,c.isTableLike)(e)}),{data:p,isLoading:h}=(0,c.isViewLike)(e)?u:m,x=(0,c.isView)(e)?`create view ${e.schema}.${e.name} as
`:(0,c.isMaterializedView)(e)?`create materialized view ${e.schema}.${e.name} as
`:"",f=(0,i.useMemo)(()=>p?(0,eB.formatSql)(x+p):void 0,[p]),g=async(e,t)=>{r.current=e,o.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eH.timeout)(500),e?.focus()};return h?(0,t.jsxs)("div",{className:"h-full grid",children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(eV.GenericSkeletonLoader,{})}),(0,t.jsx)("div",{className:"mt-auto",children:(0,t.jsx)(V,{})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,t.jsx)(I.Button,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10",children:(0,t.jsx)(n.default,{href:`/project/${s}/sql/new?content=${encodeURIComponent(f??"")}`,children:"Open in SQL Editor"})}),(0,t.jsx)(eF.default,{className:"monaco-editor",theme:l?.includes("dark")?"vs-dark":"vs",onMount:g,defaultLanguage:"pgsql",value:f,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})]}),(0,t.jsx)(V,{})]})},eW=({isLoadingSelectedTable:e=!1,selectedTable:o})=>{let l=(0,r.useRouter)(),{ref:d,id:u}=(0,a.useParams)(),{setLastVisitedTable:m}=(0,eI.useDashboardHistory)(),{selectedSchema:p}=(0,eL.useQuerySchemaState)(),h=(0,e$.useTabsStateSnapshot)();(0,B.useSyncTableEditorStateFromLocalStorageWithUrl)({projectRef:d,table:o});let[{view:f="data"}]=(0,eD.useUrlState)(),{can:g}=(0,e_.useAsyncCheckPermissions)(s.PermissionAction.TENANT_SQL_ADMIN_WRITE,"tables"),{can:b}=(0,e_.useAsyncCheckPermissions)(s.PermissionAction.TENANT_SQL_ADMIN_WRITE,"columns"),j=u?h.openTabs.find(e=>e.endsWith(u)):void 0,y=h.openTabs.filter(e=>!e.startsWith("sql")),w=(0,i.useCallback)(e=>{l.push(`/project/${d}/editor/${e.id}${p?`?schema=${p}`:""}`)},[d,l]),v=(0,i.useCallback)(async()=>{if(o){let e=(0,e$.createTabId)(o.entity_type,{id:o.id});h.handleTabClose({id:e,router:l,editor:"table",onClearDashboardHistory:()=>m(void 0)})}},[l,o,h]),{isSchemaLocked:T}=(0,eO.useIsProtectedSchema)({schema:o?.schema??""});if(e||!d)return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"h-10 bg-dash-sidebar dark:bg-surface-100"}),(0,t.jsx)("div",{className:"h-9 border-y"}),(0,t.jsx)("div",{className:"p-2 col-span-full",children:(0,t.jsx)(Z.GenericSkeletonLoader,{})})]});let C=(0,c.isView)(o)||(0,c.isMaterializedView)(o),S=(0,c.isTableLike)(o),N=(0,c.isForeignTable)(o),E=!(!g&&!b)&&S&&!T,k=o?`${o.schema}_${o.name}`:"unknown-table";return(0,t.jsxs)("div",{className:"h-full",onClick:()=>h.makeActiveTabPermanent(),children:[o?(0,t.jsxs)(x.TableEditorTableStateContextProvider,{projectRef:d,table:o,editable:E,children:[(0,t.jsx)(eR,{gridProps:{height:"100%"},customHeader:(C||S)&&"definition"===f?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("p",{children:["SQL Definition of ",(0,t.jsx)("code",{className:"text-sm",children:o.name})," "]}),(0,t.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,children:(C||S)&&"definition"===f&&(0,t.jsx)(eK,{entity:o})},k),(0,t.jsx)(eA.default,{selectedTable:S?o:void 0,onTableDeleted:v})]},`table-editor-table-${o.id}`):(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-[400px]",children:(0,t.jsx)(el.Admonition,{type:"default",title:`Unable to find your table with ID ${u}`,description:"This table doesn't exist in your database",children:j?(0,t.jsx)(I.Button,{type:"default",className:"mt-2",onClick:()=>{h.handleTabClose({id:j,router:l,editor:"table",onClearDashboardHistory:()=>m(void 0)})},children:"Close tab"}):y.length>0?(0,t.jsx)(I.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m(void 0),children:(0,t.jsx)(n.default,{href:`/project/${d}/editor/${y[0].split("-")[1]}`,children:"Close tab"})}):(0,t.jsx)(I.Button,{asChild:!0,type:"default",className:"mt-2",onClick:()=>m(void 0),children:(0,t.jsx)(n.default,{href:`/project/${d}/editor`,children:"Head back"})})})})}),(0,t.jsx)(eQ.SidePanelEditor,{editable:E,selectedTable:S||N?o:void 0,onTableCreated:w})]})};var eq=e.i(448710),eG=e.i(569715),eY=e.i(111331),eX=e.i(207831);let eZ=()=>{let{id:e,ref:s}=(0,a.useParams)(),n=e?Number(e):void 0,r=(0,e$.useTabsStateSnapshot)(),{data:o}=(0,v.useSelectedProjectQuery)(),{data:l,isPending:d}=(0,w.useTableEditorQuery)({projectRef:o?.ref,connectionString:o?.connectionString,id:n});return(0,i.useEffect)(()=>{if(l&&s){let e=(0,e$.createTabId)(l.entity_type,{id:l.id});r.tabsMap[e]?r.makeTabActive(e):r.addTab({id:e,type:l.entity_type,label:l.name,metadata:{schema:l.schema,name:l.name,tableId:n}})}},[l,n,s]),(0,t.jsx)(eW,{isLoadingSelectedTable:d,selectedTable:l})};eZ.getLayout=e=>(0,t.jsx)(eq.DefaultLayout,{children:(0,t.jsx)(eG.EditorBaseLayout,{productMenu:(0,t.jsx)(eX.TableEditorMenu,{}),product:"Table Editor",productMenuClassName:"overflow-y-hidden",children:(0,t.jsx)(eY.TableEditorLayout,{children:e})})}),e.s(["default",0,eZ],561912)},935074,(e,t,i)=>{let a="/project/[ref]/editor/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(561912)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})}]);

//# debugId=05f3880c-3099-3350-05c0-3466cd08579f
//# sourceMappingURL=6b17aeb26edebd7e.js.map