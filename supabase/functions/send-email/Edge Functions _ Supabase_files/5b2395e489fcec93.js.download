;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="3837957a-fba4-4fae-d82d-7f1dc8403a90")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,951746,(e,s,t)=>{var a=e.r(290308),l=e.r(798705);s.exports=function(e,s,t){return e&&e.length?a(e,0,(s=t||void 0===s?1:l(s))<0?0:s):[]}},399519,e=>{"use strict";var s=e.i(478902);e.i(128328);var t=e.i(158639),a=e.i(389959),l=e.i(162082),n=e.i(321605),r=e.i(265735),i=e.i(635494),o=e.i(902858),c=e.i(650608),c=c,d=e.i(656071),x=e.i(86086),m=e.i(215312),h=e.i(25224),u=e.i(2579),g=e.i(532728),p=e.i(88816),f=e.i(408891),j=e.i(531837),b=e.i(513826),v=e.i(10429),y=e.i(837710),N=e.i(24315),w=e.i(215317),S=e.i(61863),_=e.i(191209),C=e.i(837243),k=e.i(428353),R=e.i(378277),P=e.i(793912),z=e.i(135144),E=e.i(689805),M=e.i(290811);let L=j.object({channel:j.string(),isPrivate:j.boolean()}),T=({config:e,onChangeConfig:n})=>{let[i,o]=(0,a.useState)(!1),{ref:c}=(0,t.useParams)(),{data:d}=(0,r.useSelectedOrganizationQuery)(),{mutate:m}=(0,l.useSendEventMutation)(),u=(0,f.useForm)({mode:"onBlur",reValidateMode:"onBlur",resolver:(0,g.zodResolver)(L),defaultValues:{channel:"",isPrivate:!1}}),j=async()=>{o(!1),m({action:"realtime_inspector_listen_channel_clicked",groups:{project:c??"Unknown",organization:d?.slug??"Unknown"}});let s=e.token;(s.startsWith("sb_temp")||!x.IS_PLATFORM)&&(s=(await (0,h.getTemporaryAPIKey)({projectRef:e.projectRef,expiry:3600})).api_key),n({...e,token:s,channelName:u.getValues("channel"),isChannelPrivate:u.getValues("isPrivate"),enabled:!0})};return(0,s.jsxs)(E.Popover_Shadcn_,{open:i,onOpenChange:s=>{!0===s&&u.setValue("channel",e.channelName),o(s)},children:[(0,s.jsx)(z.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,s.jsx)(y.Button,{className:"rounded-r-none",type:"default",size:"tiny",iconRight:(0,s.jsx)(p.ChevronDown,{}),children:(0,s.jsx)("p",{className:"max-w-[120px] truncate",title:e.channelName.length>0?e.channelName:"",children:e.channelName.length>0?`Channel: ${e.channelName}`:"Join a channel"})})}),(0,s.jsx)(P.PopoverContent_Shadcn_,{portal:!0,className:"p-0 w-[320px]",align:"start",children:(0,s.jsx)("div",{className:"p-4 flex flex-col text-sm",children:0===e.channelName.length?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(k.Form_Shadcn_,{...u,children:(0,s.jsxs)("form",{id:"realtime-channel",onSubmit:u.handleSubmit(()=>j()),className:"flex flex-col gap-y-4",children:[(0,s.jsx)(S.FormField_Shadcn_,{name:"channel",control:u.control,render:({field:e})=>(0,s.jsxs)(_.FormItem_Shadcn_,{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("label",{className:"text-foreground text-xs",children:"Name of channel"}),(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(N.FormControl_Shadcn_,{children:(0,s.jsx)(R.Input_Shadcn_,{...e,autoComplete:"off",className:"rounded-r-none text-xs px-2.5 py-1 h-auto",placeholder:"Enter a channel name"})}),(0,s.jsx)(y.Button,{type:"primary",className:"rounded-l-none",disabled:0===u.getValues().channel.length,onClick:()=>j(),children:"Listen to channel"})]})]}),(0,s.jsxs)(w.FormDescription_Shadcn_,{className:"text-xs text-foreground-lighter",children:["The channel you initialize with the Supabase Realtime client. Learn more in"," ",(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",className:"underline hover:text-foreground transition",href:`${v.DOCS_URL}/guides/realtime/concepts#channels`,children:"our docs"})]})]})}),(0,s.jsx)(S.FormField_Shadcn_,{control:u.control,name:"isPrivate",render:({field:e})=>(0,s.jsxs)(_.FormItem_Shadcn_,{className:"",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,s.jsx)(N.FormControl_Shadcn_,{children:(0,s.jsx)(M.Switch,{checked:e.value,onCheckedChange:e.onChange,disabled:e.disabled})}),(0,s.jsx)(C.FormLabel_Shadcn_,{className:"text-xs",children:"Is channel private?"})]}),(0,s.jsx)(w.FormDescription_Shadcn_,{className:"text-xs text-foreground-lighter mt-2",children:"If the channel is marked as private, it will use RLS policies to filter messages."})]})},"isPrivate"),(0,s.jsx)(b.DocsButton,{abbrev:!1,className:"w-min",href:`${v.DOCS_URL}/guides/realtime/authorization`})]})})}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsxs)("p",{className:"text-foreground text-xs",children:["Currently joined"," ",(0,s.jsx)("span",{className:e.isChannelPrivate?"text-brand":"text-warning",children:e.isChannelPrivate?"private":"public"})," ","channel:"]}),(0,s.jsx)("p",{className:"text-xs border border-scale-600  py-0.5 px-1 rounded-md bg-surface-200",children:e.channelName})]}),(0,s.jsx)("p",{className:"text-xs text-foreground-lighter mt-2",children:"If you leave this channel, all of the messages populated on this page will disappear"}),(0,s.jsx)(y.Button,{type:"default",onClick:()=>n({...e,channelName:"",enabled:!1}),children:"Leave channel"})]})})})]})};var A=e.i(82394),B=e.i(215261),F=e.i(587433),I=e.i(363246);let D=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{id:"Ellipse 146",d:"M17.3154 6.70312C18.6968 8.06227 19.5532 9.95249 19.5532 12.0426C19.5532 14.1326 18.6968 16.0229 17.3154 17.382M6.79102 6.70312C5.40966 8.06227 4.55322 9.95249 4.55322 12.0426C4.55322 14.1326 5.40966 16.0229 6.79102 17.382",stroke:"currentColor",strokeMiterlimit:"10",strokeLinejoin:"bevel",opacity:.45}),(0,s.jsx)("ellipse",{id:"Ellipse 144",cx:"12.0532",cy:"12.0428",rx:"3.00928",ry:"3.00666",stroke:"currentColor",strokeMiterlimit:"10",strokeLinejoin:"bevel"}),(0,s.jsx)("path",{id:"Vector 96",d:"M12.0747 15.0488L12.0747 23.9996",stroke:"currentColor",strokeMiterlimit:"10",strokeLinejoin:"bevel"})]}),O=function(e){return(0,s.jsx)(I.default,{src:(0,s.jsx)(D,{}),viewBox:"0 0 24 24",...e})},U=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:25,height:24,fill:"none",children:[(0,s.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"bevel",strokeMiterlimit:10,d:"M20.307 12a7.807 7.807 0 0 1-7.807 7.808M4.693 12A7.807 7.807 0 0 1 12.5 4.193",opacity:.45}),(0,s.jsx)("circle",{cx:17.512,cy:6.971,r:3.723,stroke:"currentColor",strokeLinejoin:"bevel",strokeMiterlimit:10}),(0,s.jsx)("path",{stroke:"currentColor",strokeLinejoin:"bevel",strokeMiterlimit:10,d:"m10.11 13.287 2.137 3.703-2.138 3.703H5.833L3.695 16.99l2.138-3.703h4.276Z"})]}),$=function(e){return(0,s.jsx)(I.default,{src:(0,s.jsx)(U,{}),viewBox:"0 0 25 24",...e})},W=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{stroke:"currentColor",strokeLinejoin:"round",strokeMiterlimit:10,d:"m23.149 23.499 3.424 7.83a.5.5 0 0 0 .942-.074l.74-2.868a.5.5 0 0 1 .364-.36l3.039-.756a.5.5 0 0 0 .08-.943l-7.93-3.487a.5.5 0 0 0-.66.658Z"}),(0,s.jsx)("path",{stroke:"currentColor",strokeLinejoin:"round",strokeMiterlimit:10,d:"M24.544 32.746h-5.623a3 3 0 0 1-3-3V18.5a3 3 0 0 1 3-3h11.247a3 3 0 0 1 3 3v5.623",opacity:.45})]}),Q=function(e){return(0,s.jsx)(I.default,{src:(0,s.jsx)(W,{}),viewBox:"12.5 12 24 24",...e})};var J=e.i(171997),H=e.i(905596),K=e.i(843778),V=e.i(466472),Y=e.i(300424);let G=({value:e,onChange:t})=>(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,s.jsx)("p",{className:"w-[60px] flex justify-end text-sm",children:"WHERE"}),(0,s.jsx)(Y.default,{disabled:!0,supportSelectAll:!0,size:"small",selectedSchemaName:e,onSelectSchema:t,className:"rounded-l-none [&>button>span>div]:py-0 w-64"})]});var X=e.i(63756),Z=e.i(370410),q=e.i(454370),ee=e.i(585915),es=e.i(740413),et=e.i(206413),ea=e.i(592360),el=e.i(178527),en=e.i(703526),er=e.i(917007),ei=e.i(920432),eo=e.i(549815),ec=e.i(911509),ed=e.i(866205),ex=e.i(396831);let em=({className:e,size:t="tiny",showError:l=!0,selectedSchemaName:n,selectedTableName:r,onSelectTable:o})=>{let[c,d]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),{data:h}=(0,i.useSelectedProjectQuery)(),[u,g]=(0,a.useState)(""),{data:p,isPending:f,isSuccess:j,isError:b,error:v,refetch:N}=(0,es.useEntityTypesQuery)({projectRef:h?.ref,search:u,connectionString:h?.connectionString,schemas:[n]});(0,a.useEffect)(()=>{!x&&j&&m(!0)},[x,j]),(0,a.useEffect)(()=>{c||""===u||g("")},[c,u]);let w=(0,X.default)(g),S=(p?.pages[0].data.entities?[...p?.pages[0].data.entities]:[]).sort((e,s)=>e.name>s.name?0:-1);return(0,s.jsx)("div",{className:e,children:(0,s.jsxs)(E.Popover_Shadcn_,{open:c,onOpenChange:d,modal:!1,children:[(0,s.jsx)(z.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,s.jsx)(y.Button,{size:t,type:"outline",disabled:f,className:`w-full [&>span]:w-full ${"small"===t?"py-1.5":""}`,icon:f?(0,s.jsx)(ee.Loader,{className:"animate-spin",size:12}):null,iconRight:(0,s.jsx)(q.Code,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),children:x?(0,s.jsxs)("div",{className:"w-full flex space-x-3",children:[(0,s.jsx)("p",{className:"text-xs text-light",children:"table"}),(0,s.jsx)("p",{className:"text-xs",children:"*"===r?"All tables":r})]}):(0,s.jsx)("p",{className:"flex text-xs text-light",children:"Loading tables..."})})}),(0,s.jsx)(P.PopoverContent_Shadcn_,{className:"p-0 w-64",side:"bottom",align:"start",children:(0,s.jsxs)(ed.Command_Shadcn_,{children:[(0,s.jsx)(ei.CommandInput_Shadcn_,{placeholder:"Find table...",onValueChange:e=>w(e)}),(0,s.jsxs)(ec.CommandList_Shadcn_,{children:[f&&(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 px-3 py-2",children:[(0,s.jsx)(ee.Loader,{className:"animate-spin",size:12}),(0,s.jsx)("p",{className:"flex text-xs text-light",children:"Loading tables..."})]}),l&&b&&(0,s.jsxs)(el.Alert_Shadcn_,{variant:"warning",className:"!px-3 !py-3 !border-0 rounded-none",children:[(0,s.jsx)(ea.AlertTitle_Shadcn_,{className:"text-xs text-amber-900",children:"Failed to load tables"}),(0,s.jsxs)(et.AlertDescription_Shadcn_,{className:"text-xs mb-2",children:["Error: ",v?.message]}),(0,s.jsx)(y.Button,{type:"default",size:"tiny",onClick:()=>N(),children:"Reload tables"})]}),j&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(er.CommandGroup_Shadcn_,{forceMount:!0,children:(0,s.jsxs)(ex.ScrollArea,{className:(S||[]).length>7?"h-[210px]":"",children:[0===S.length&&(0,s.jsx)(en.CommandEmpty_Shadcn_,{children:"No tables found"}),!u&&(0,s.jsxs)(eo.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{o("*",void 0),d(!1)},onClick:()=>{o("*",void 0),d(!1)},children:[(0,s.jsx)("span",{children:"All tables"}),"*"===n&&(0,s.jsx)(Z.Check,{className:"text-brand",strokeWidth:2})]},"all-tables"),S?.map(e=>(0,s.jsxs)(eo.CommandItem_Shadcn_,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{o(e.name,e.id),d(!1)},onClick:()=>{o(e.name,e.id),d(!1)},children:[(0,s.jsx)("span",{children:e.name}),n===e.name&&(0,s.jsx)(Z.Check,{className:"text-brand",strokeWidth:2})]},e.id))]})})})]})]})})]})})},eh=({value:e,schema:t,onChange:a})=>(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,s.jsx)("p",{className:"w-[60px] flex justify-end text-sm",children:"AND"}),(0,s.jsx)(em,{selectedSchemaName:t,selectedTableName:e,onSelectTable:a,className:"w-64",size:"small"})]}),eu=({config:e,onChangeConfig:n})=>{let[i,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[x,m]=(0,a.useState)(e),{ref:h}=(0,t.useParams)(),{data:u}=(0,r.useSelectedOrganizationQuery)(),{mutate:g}=(0,l.useSendEventMutation)();(0,a.useEffect)(()=>{m(e)},[e]);let p="*"!==e.table;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(E.Popover_Shadcn_,{open:i,onOpenChange:s=>{!0===s&&m(e),o(s)},children:[(0,s.jsx)(z.PopoverTrigger_Shadcn_,{asChild:!0,children:(0,s.jsx)(y.Button,{icon:(0,s.jsx)(A.PlusCircle,{size:"16"}),type:p?"primary":"dashed",className:(0,K.cn)("rounded-full px-1 text-xs h-[26px]"),size:"small",children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mr-1",children:"Filtered by "}),(0,s.jsxs)(F.Badge,{variant:"success",children:["table: ",e.table]})]}):(0,s.jsx)("span",{className:"mr-1",children:"Filter messages"})})}),(0,s.jsxs)(P.PopoverContent_Shadcn_,{className:"p-0 w-[365px]",align:"start",portal:!0,children:[(0,s.jsx)("div",{className:"border-b border-overlay text-xs px-4 py-3 text-foreground",children:"Listen to event types"}),(0,s.jsxs)("div",{className:"py-3 px-4 border-b border-overlay",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex gap-2.5 items-center",children:[(0,s.jsx)(Q,{size:"xlarge",className:"bg-foreground rounded text-background-muted"}),(0,s.jsx)("label",{htmlFor:"toggle-presence",className:"text-sm",children:"Presence"})]}),(0,s.jsx)(H.Toggle,{id:"toggle-presence",size:"tiny",checked:x.enablePresence,onChange:()=>m({...x,enablePresence:!x.enablePresence})})]}),(0,s.jsx)("p",{className:"text-xs text-foreground-light pt-1",children:"Store and synchronize user state consistently across clients"})]}),(0,s.jsxs)("div",{className:"py-3 px-4 border-b border-overlay",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex gap-2.5 items-center",children:[(0,s.jsx)(O,{size:"xlarge",className:"bg-foreground rounded text-background-muted"}),(0,s.jsx)("label",{htmlFor:"toggle-broadcast",className:"text-sm",children:"Broadcast"})]}),(0,s.jsx)(H.Toggle,{id:"toggle-broadcast",size:"tiny",checked:x.enableBroadcast,onChange:()=>m({...x,enableBroadcast:!x.enableBroadcast})})]}),(0,s.jsx)("p",{className:"text-xs  text-foreground-light pt-1",children:"Send any data to any client subscribed to the same channel"})]}),(0,s.jsxs)("div",{className:"py-3 px-4 border-b border-overlay",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex gap-2.5 items-center",children:[(0,s.jsx)($,{size:"xlarge",className:(0,K.cn)("rounded text-background-muted",e.enableDbChanges?"bg-foreground":"bg-foreground-lighter")}),(0,s.jsx)("label",{htmlFor:"toggle-db-changes",className:(0,K.cn)("text-sm",!e.enableDbChanges&&"text-foreground-lighter"),children:"Database changes"})]}),(0,s.jsx)(H.Toggle,{id:"toggle-db-changes",size:"tiny",checked:x.enableDbChanges,disabled:!e.enableDbChanges,onChange:()=>m({...x,enableDbChanges:!x.enableDbChanges})})]}),(0,s.jsx)("p",{className:"text-xs text-foreground-light pt-1",children:e.enableDbChanges?"Listen for Database inserts, updates, deletes and more":"Enable realtime publications to listen for database changes"})]}),x.enableDbChanges&&e.enableDbChanges&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"border-b border-overlay text-xs px-4 py-3 text-foreground",children:"Filter messages from database changes"}),(0,s.jsxs)("div",{className:"flex border-b border-overlay p-4 gap-y-2 flex-col",children:[(0,s.jsx)(G,{value:x.schema,onChange:e=>m({...x,schema:e,table:"*"})}),(0,s.jsx)(eh,{value:x.table,schema:x.schema,onChange:e=>m({...x,table:e})})]}),(0,s.jsxs)("div",{className:"border-b border-overlay p-4 flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,s.jsx)("p",{className:"w-[60px] flex justify-end text-sm",children:"AND"}),(0,s.jsx)(J.Input,{size:"tiny",className:"flex-grow",placeholder:"body=eq.hey",value:x.filter,onChange:e=>m({...x,filter:e.target.value})})]}),(0,s.jsxs)("p",{className:"text-xs text-foreground-light pl-[80px]",children:["Learn more about realtime filtering in"," ",(0,s.jsx)(B.default,{className:"underline",target:"_blank",rel:"noreferrer",href:`${v.DOCS_URL}/guides/realtime/postgres-changes#available-filters`,children:"our docs"})]})]})]}),(0,s.jsxs)("div",{className:"px-4 py-2 gap-2 flex justify-end",children:[(0,s.jsx)(y.Button,{type:"default",onClick:()=>o(!1),children:"Cancel"}),(0,s.jsx)(y.Button,{onClick:()=>d(!0),children:"Apply"})]})]})]}),(0,s.jsx)(V.default,{title:"Previously found messages will be lost",variant:"destructive",confirmLabel:"Confirm",size:"small",visible:c,onCancel:()=>d(!1),onConfirm:()=>{g({action:"realtime_inspector_filters_applied",groups:{project:h??"Unknown",organization:u?.slug??"Unknown"}}),n(x),d(!1),o(!1)},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"The realtime inspector will clear currently collected messages and start listening for new messages matching the updated filters."})})]})};var eg=e.i(355901),ep=e.i(686415),ef=e.i(108892),ej=e.i(462142),eb=e.i(908937),ev=e.i(201461);let ey=({config:e,onChangeConfig:n})=>{let{ref:i}=(0,t.useParams)(),{data:c}=(0,r.useSelectedOrganizationQuery)(),d=(0,ev.useRoleImpersonationStateSnapshot)(),{can:x}=(0,u.useAsyncCheckPermissions)(o.PermissionAction.SECRETS_READ,"*"),{data:m}=(0,ef.useAPIKeysQuery)({projectRef:e.projectRef,reveal:!0},{enabled:x}),{anonKey:g,publishableKey:p}=(0,ef.getKeys)(m),{data:f}=(0,ej.useProjectPostgrestConfigQuery)({projectRef:e.projectRef},{enabled:v.IS_PLATFORM}),j=f?.jwt_secret,{mutate:b}=(0,l.useSendEventMutation)(),y=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{y.current&&b({action:"realtime_inspector_database_role_updated",groups:{project:i??"Unknown",organization:c?.slug??"Unknown"}}),y.current=!0},[d.role]),(0,a.useEffect)(()=>{(async()=>{let s,t=null;if(void 0!==e.projectRef&&void 0!==j&&void 0!==d.role&&"postgrest"===d.role.type)s=p?.api_key??g?.api_key,await (0,eb.getRoleImpersonationJWT)(e.projectRef,j,d.role).then(e=>t=e).catch(e=>eg.toast.error(`Failed to get JWT for role: ${e.message}`));else try{s=(await (0,h.getTemporaryAPIKey)({projectRef:e.projectRef,expiry:3600})).api_key}catch(e){s=p?.api_key}s&&n({...e,token:s,bearer:t})})()},[d.role,g]),(0,s.jsx)(ep.RoleImpersonationPopover,{align:"start",variant:"connected-on-both"})},eN=({config:e,onChangeConfig:a})=>{let{mutate:n}=(0,l.useSendEventMutation)(),{ref:i}=(0,t.useParams)(),{data:g}=(0,r.useSelectedOrganizationQuery)(),{can:p}=(0,u.useAsyncCheckPermissions)(o.PermissionAction.READ,"service_api_keys");return(0,s.jsxs)("div",{className:"flex flex-row h-14 gap-2.5 items-center px-4",children:[(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(T,{config:e,onChangeConfig:a}),(0,s.jsx)(ey,{config:e,onChangeConfig:a}),(0,s.jsx)(m.ButtonTooltip,{size:"tiny",type:e.enabled?"warning":"primary",className:"rounded-l-none border-l-0",disabled:!p||0===e.channelName.length,icon:e.enabled?(0,s.jsx)(d.StopCircle,{size:"16"}):(0,s.jsx)(c.default,{size:"16"}),onClick:async()=>{if(!e.enabled&&(e.token.startsWith("sb_temp")||!x.IS_PLATFORM)){let s=(await (0,h.getTemporaryAPIKey)({projectRef:e.projectRef,expiry:3600})).api_key;a({...e,token:s,enabled:!e.enabled})}else a({...e,enabled:!e.enabled});e.enabled||n({action:"realtime_inspector_listen_channel_clicked",groups:{project:i??"Unknown",organization:g?.slug??"Unknown"}})},tooltip:{content:{side:"bottom",text:p?0===e.channelName.length?"You need to join a channel first":void 0:"You need additional permissions to use the realtime inspector"}},children:e.enabled?"Stop listening":"Start listening"})]}),(0,s.jsx)(eu,{config:e,onChangeConfig:a})]})};var ew=e.i(408880),eS=e.i(17203),e_=e.i(774803),eC=e.i(532610),ek=e.i(591385),eR=e.i(693241),eP=e.i(427432),ez=e.i(108151),eE=e.i(975924),eM=e.i(223600),eL=e.i(55956);let eT=({children:e})=>(0,s.jsx)("div",{className:"flex h-full w-full items-center gap-4",children:e}),eA=({value:e,hideCopy:t=!1})=>(0,s.jsx)(eB,{label:"Timestamp",value:eL.default.unix(Number(e)/1e3).toISOString(),hideCopy:t}),eB=({label:e,value:t,valueRender:a,hideCopy:l=!1})=>(0,s.jsxs)("div",{className:"grid grid-cols-12 group",children:[(0,s.jsx)("span",{className:"text-scale-900 text-sm col-span-4 whitespace-pre-wrap",children:e}),(0,s.jsx)("span",{className:"text-scale-1200 text-sm col-span-6 whitespace-pre-wrap break-all",children:a??t}),!l&&(0,s.jsx)(eM.default,{text:t,className:"group-hover:opacity-100 opacity-0 my-auto transition col-span-2  h-4 w-4 px-0 py-0",type:"text",title:"Copy to clipboard"})]}),eF=()=>(0,s.jsx)("div",{className:"h-px w-full bg-panel-border-interior-light [[data-theme*=dark]_&]:bg-panel-border-interior-dark"}),eI=({log:e})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-8",children:[(0,s.jsx)("span",{className:"col-span-4 text-sm text-scale-900",children:"Message"}),(0,s.jsx)("p",{className:"text-wrap mt-2 overflow-x-auto whitespace-pre-wrap font-mono text-xs text-scale-1200",children:e.message})]}),(0,s.jsx)(eF,{}),(0,s.jsx)("div",{className:"px-8 space-y-2",children:(0,s.jsx)(eA,{hideCopy:!0,value:e.timestamp})}),(0,s.jsx)(eF,{}),(0,s.jsxs)("div",{className:"px-8",children:[(0,s.jsx)("h3",{className:"mb-4 text-sm text-foreground-lighter",children:"Payload"}),(0,s.jsx)("pre",{className:"syntax-highlight overflow-x-auto text-sm",children:(0,s.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:e.metadata?JSON.stringify(e.metadata,null,2).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var s="number text-tomato-900";return/^"/.test(e)?s=/:$/.test(e)?"key text-scale-1200":"string text-brand-600":/true|false/.test(e)?s="boolean text-blue-900":/null/.test(e)&&(s="null text-amber-1100"),'<span class="'+s+'">'+e+"</span>"}).split(`
`).map(e=>`<span class="line text-xs">${e}</span>`).join("\n"):""}})})]})]}),eD=({log:e,onClose:n})=>{let i=(0,a.useMemo)(()=>JSON.stringify(e,null,2),[e]),{ref:o}=(0,t.useParams)(),{data:c}=(0,r.useSelectedOrganizationQuery)(),{mutate:d}=(0,l.useSendEventMutation)();return(0,s.jsxs)("div",{className:(0,K.cn)("relative flex h-full flex-grow flex-col border-l border-t-2 overflow-y-scroll bg-200"),children:[(0,s.jsx)("div",{className:(0,K.cn)("absolute flex h-full w-full flex-col items-center justify-center gap-2 bg-200 text-center opacity-0 transition-all",e?"z-0 opacity-0":"z-10 opacity-100"),children:(0,s.jsxs)("div",{className:(0,K.cn)("flex w-full max-w-sm scale-95 flex-col items-center justify-center gap-6 text-center opacity-0 transition-all delay-300 duration-500",e?"mt-0 scale-95 opacity-0":"mt-8 scale-100 opacity-100"),children:[(0,s.jsxs)("div",{className:"relative flex h-4 w-32 items-center rounded border border-default px-2",children:[(0,s.jsx)("div",{className:"h-0.5 w-2/3 rounded-full bg-overlay-hover"}),(0,s.jsx)("div",{className:"absolute right-1 -bottom-4",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"})})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("h3",{className:"text-sm text-foreground",children:"Select a message"}),(0,s.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Click on a message on the left to view details."})]})]})}),(0,s.jsxs)("div",{className:"relative h-px flex-grow",children:[(0,s.jsxs)("div",{className:"pt-4 flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"px-4 flex flex-row justify-between items-center",children:[(0,s.jsx)("div",{className:"transition",children:(0,s.jsx)(eM.default,{text:i,type:"default",title:"Copy log to clipboard",onClick:()=>{d({action:"realtime_inspector_copy_message_clicked",groups:{project:o??"Unknown",organization:c?.slug??"Unknown"}})}})}),(0,s.jsx)(y.Button,{type:"text",className:"cursor-pointer transition hover:text-scale-1200 h-8 w-8 px-0 py-0 flex items-center justify-center",onClick:n,children:(0,s.jsx)(eE.X,{size:14,strokeWidth:2,className:"text-scale-900"})})]}),(0,s.jsx)("div",{className:"h-px w-full bg-scale-600 rounded"})]}),(0,s.jsx)("div",{className:"flex flex-col space-y-6 py-4",children:e&&(0,s.jsx)(eI,{log:e})})]})]})},eO=()=>(0,s.jsxs)("div",{className:"border bg-studio border-border rounded-md justify-start items-center flex flex-col w-10/12 relative",children:[(0,s.jsx)("div",{className:"w-full px-5 py-4 items-center gap-4 inline-flex border-b rounded-t-md",children:(0,s.jsxs)("div",{className:"grow flex-col flex gap-y-1",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Join a channel to start listening to messages"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Channels are the building blocks of realtime where clients can bi-directionally send and receive messages in."})]})}),(0,s.jsxs)("div",{className:(0,K.cn)("w-full px-5 py-4 items-center gap-4 inline-flex"),children:[(0,s.jsxs)("div",{className:"grow flex-col flex",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Not sure what to do?"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Browse our documentation"})]}),(0,s.jsx)(b.DocsButton,{href:`${v.DOCS_URL}/guides/realtime`})]})]});var eU=e.i(217444);let e$={PRESENCE:(0,s.jsx)(Q,{size:"xlarge"}),BROADCAST:(0,s.jsx)(O,{size:"xlarge"}),POSTGRES:(0,s.jsx)($,{size:"xlarge"}),SYSTEM:(0,s.jsx)(eU.AlertTriangle,{size:"20",strokeWidth:1})},eW=[{name:"timestamp-with-truncated-text",key:"main-column",renderHeaderCell:()=>null,renderCell:e=>{let t=e.row.message;return(0,s.jsxs)(eT,{children:[(0,s.jsx)("div",{className:(0,K.cn)("flex justify-center items-center min-w-[24px]",eQ(e.row)?"text-warning":"text-green-900"),children:e$[t]}),(0,s.jsx)("span",{className:(0,K.cn)("font-mono",eQ(e.row)?"!text-warning":""),children:new Date(e.row.timestamp).toISOString()}),(0,s.jsx)("span",{className:(0,K.cn)("truncate font-mono",eQ(e.row)?"!text-warning":""),children:JSON.stringify(e.row.metadata)})]})}}],eQ=e=>"SYSTEM"===e.message&&e.metadata?.status==="error",eJ=({enabled:e,hasChannelSet:a,showSendMessage:l})=>{let{ref:n}=(0,t.useParams)(),{can:r,isLoading:i}=(0,u.useAsyncCheckPermissions)(o.PermissionAction.READ,"service_api_keys");return(0,s.jsx)("div",{className:"w-full max-w-md flex items-center flex-col",children:i?(0,s.jsx)(ez.GenericSkeletonLoader,{className:"w-80"}):r?a?(0,s.jsxs)(s.Fragment,{children:[e&&(0,s.jsx)("p",{className:"text-foreground",children:"No Realtime messages found"}),(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Realtime message logs will be shown here"}),(0,s.jsxs)("div",{className:"mt-4 border bg-surface-100 border-border rounded-md justify-start items-center flex flex-col w-full",children:[(0,s.jsxs)("div",{className:"w-full px-5 py-4 items-center gap-4 inline-flex border-b",children:[(0,s.jsx)(O,{size:"xlarge",className:"text-background bg-foreground rounded w-6"}),(0,s.jsxs)("div",{className:"grow flex-col flex",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Create a Broadcast message"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Send a message in the channel"})]}),(0,s.jsx)(y.Button,{type:"default",onClick:l,children:"Broadcast a message"})]}),(0,s.jsxs)("div",{className:"w-full px-5 py-4 items-center gap-4 inline-flex border-b",children:[(0,s.jsx)(Q,{size:"xlarge",className:"text-background bg-foreground rounded w-6"}),(0,s.jsxs)("div",{className:"grow flex-col flex",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Join from another browser tab"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Send messages between multiple clients"})]}),(0,s.jsx)(B.default,{href:`/project/${n}/realtime/inspector`,target:"_blank",rel:"noreferrer",children:(0,s.jsx)(y.Button,{type:"default",iconRight:(0,s.jsx)(eS.ExternalLink,{}),children:"Open inspector"})})]}),(0,s.jsxs)("div",{className:"w-full px-5 py-4 items-center gap-4 inline-flex border-b",children:[(0,s.jsx)($,{size:"xlarge",className:"text-background bg-foreground rounded w-6"}),(0,s.jsxs)("div",{className:"grow flex-col flex",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Listen to a table for changes"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Tables must have realtime enabled"})]}),(0,s.jsx)(B.default,{href:`/project/${n}/database/publications`,target:"_blank",rel:"noreferrer",children:(0,s.jsx)(y.Button,{type:"default",iconRight:(0,s.jsx)(eS.ExternalLink,{}),children:"Publications settings"})})]}),(0,s.jsxs)("div",{className:"w-full px-5 py-4 items-center gap-4 inline-flex rounded-b-md bg-studio",children:[(0,s.jsxs)("div",{className:"grow flex-col flex",children:[(0,s.jsx)("p",{className:"text-foreground",children:"Not sure what to do?"}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:"Browse our documentation"})]}),(0,s.jsx)(b.DocsButton,{href:`${v.DOCS_URL}/guides/realtime`})]})]})]}):(0,s.jsx)(eO,{}):(0,s.jsx)(eR.default,{isFullPage:!0,resourceText:"use the realtime inspector"})})},eH=({enabled:e,hasChannelSet:n,data:i=[],showSendMessage:o})=>{let[c,d]=(0,a.useState)(null),x=JSON.stringify(i),{ref:m}=(0,t.useParams)(),{data:h}=(0,r.useSelectedOrganizationQuery)(),{mutate:u}=(0,l.useSendEventMutation)();return((0,a.useEffect)(()=>{!i||i.find(e=>e.id===c?.id)||d(null)},[x]),i)?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("section",{className:"flex w-full flex-col",style:{maxHeight:"calc(100vh - 42px - 3rem)"},children:[(0,s.jsx)(eP.default,{active:e}),(0,s.jsxs)("div",{className:(0,K.cn)("flex h-full flex-row",e?"border-brand-400":null),children:[(0,s.jsxs)("div",{className:"flex flex-grow flex-col",children:[e&&(0,s.jsxs)("div",{className:"w-full h-9 px-4 bg-surface-100 border-b items-center inline-flex justify-between text-foreground-light",children:[(0,s.jsxs)("div",{className:"inline-flex gap-2.5 text-xs",children:[(0,s.jsx)(e_.Loader2,{size:"16",className:"animate-spin"}),(0,s.jsx)("div",{children:"Listening"}),(0,s.jsx)("div",{children:"â€¢"}),(0,s.jsx)("div",{children:i.length>0?i.length>=100?"Found a large number of messages, showing only the latest 100...":`Found ${i.length} messages...`:"No message found yet..."})]}),(0,s.jsx)(y.Button,{type:"default",onClick:o,icon:(0,s.jsx)(eC.Megaphone,{strokeWidth:1.5}),children:(0,s.jsx)("span",{children:"Broadcast a message"})})]}),(0,s.jsx)(ek.default,{className:"data-grid--simple-logs h-full border-b-0",rowHeight:40,headerRowHeight:0,columns:eW,rowClass:e=>(0,K.cn)(["font-mono tracking-tight",(0,ew.default)(e,c)?"bg-scale-800 rdg-row--focused":"bg-200 hover:bg-scale-300 cursor-pointer",eQ(e)&&"!bg-warning-300"]),rows:i,rowKeyGetter:e=>e.id,renderers:{renderRow(e,t){let{row:a}=t;return(0,s.jsx)(ek.Row,{...t,isRowSelected:!1,selectedCellIdx:void 0,onClick:()=>{u({action:"realtime_inspector_message_clicked",groups:{project:m??"Unknown",organization:h?.slug??"Unknown"}}),d(a)}},e)},noRowsFallback:(0,s.jsx)("div",{className:"mx-auto flex h-full w-full items-center justify-center space-y-12 py-4 transition-all delay-200 duration-500",children:(0,s.jsx)(eJ,{enabled:e,hasChannelSet:n,showSendMessage:o})})}})]}),(0,s.jsx)("div",{className:"flex w-1/2 flex-col",children:(0,s.jsx)(eD,{onClose:()=>d(null),log:c})})]})]})}):null};var eK=e.i(653961),eV=e.i(48189),eY=e.i(40892);let eG={message:"Test message",payload:'{ "message": "Hello World" }'},eX=({visible:e,onSelectCancel:t,onSelectConfirm:l})=>{let[n,r]=(0,a.useState)(),[i,o]=(0,a.useState)(eG);return(0,a.useEffect)(()=>{e&&(r(void 0),o(eG))},[e]),(0,s.jsx)(eY.Modal,{size:"medium",alignFooter:"right",header:"Broadcast a message to all clients",visible:e,loading:!1,onCancel:t,onConfirm:()=>{let e=(0,eV.tryParseJson)(i.payload);void 0===e?r("Please provide a valid JSON"):l({...i,payload:e})},children:(0,s.jsxs)(eY.Modal.Content,{className:"flex flex-col gap-y-4",children:[(0,s.jsx)(J.Input,{label:"Message name",size:"small",className:"flex-grow",value:i.message,onChange:e=>o({...i,message:e.target.value})}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-scale-1100",children:"Message payload"}),(0,s.jsx)(eK.default,{id:"message-payload",language:"json",className:"!mb-0 h-32 overflow-hidden rounded border",onInputChange:e=>o({...i,payload:e??"{}"}),options:{wordWrap:"off",contextmenu:!1},value:i.payload}),void 0!==n&&(0,s.jsx)("p",{className:"text-sm text-red-900",children:n})]})]})})};e.i(695677);var eZ=e.i(690601),eZ=eZ,eq=e.i(893524),e0=e.i(951746),e1=e.i(377451),e2=e.i(681328);let e3={"X-Client-Info":"supabase-js-web/studio"};function e4(e,s){return"clear"===s.type?e2.EMPTY_ARR:(0,e0.default)((0,eq.default)([{id:(0,eV.uuidv4)(),timestamp:new Date().getTime(),message:s.payload.messageType,metadata:s.payload.metadata},...e],e=>-e.timestamp),100)}var e5=e.i(215618),e6=e.i(317040),e9=e.i(441081),e8=e.i(602089),e7=e.i(627069),se=e.i(265100),ss=e.i(731228);let st=()=>{let[e,t]=(0,a.useState)({x:20,y:20}),[l,n]=(0,a.useState)({x:180,y:80});return(0,a.useEffect)(()=>{let e=()=>{t({x:160*Math.random()+20,y:80*Math.random()+20}),n({x:160*Math.random()+20,y:80*Math.random()+20})},s=setTimeout(e,1e3),a=setInterval(e,3e3);return()=>{clearTimeout(s),clearInterval(a)}},[]),(0,s.jsxs)("div",{className:"relative w-48 h-32 mx-auto mb-8",children:[(0,s.jsx)(se.motion.div,{className:"absolute text-warning",animate:{x:e.x,y:e.y},transition:{duration:1.2,ease:"easeInOut"},style:{width:20,height:20},children:(0,s.jsx)(ss.MousePointer2,{size:20})}),(0,s.jsx)(se.motion.div,{className:"absolute text-brand",animate:{x:l.x,y:l.y},transition:{duration:1.2,ease:"easeInOut",delay:.2},style:{width:20,height:20},children:(0,s.jsx)(ss.MousePointer2,{size:20})})]})},sa=({projectRef:e})=>{let t=(0,e6.useAiAssistantStateSnapshot)(),{openSidebar:a}=(0,e9.useSidebarManagerSnapshot)();return(0,s.jsx)("div",{className:"flex grow items-center justify-center p-12 border-t @container",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl flex flex-col items-center gap-0",children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)(st,{}),(0,s.jsx)("h2",{className:"heading-section mb-1",children:"Create realtime experiences"}),(0,s.jsx)("p",{className:"text-foreground-light mb-6",children:"Send your first realtime message from your database, application code or edge function"}),(0,s.jsx)(y.Button,{type:"default",icon:(0,s.jsx)(e8.AiIconAnimation,{}),onClick:()=>{a(e5.SIDEBAR_KEYS.AI_ASSISTANT),t.newChat({name:"Realtime",initialInput:"Help me set up a realtime experience for my project"})},children:"Set up realtime for me"})]}),(0,s.jsxs)(e7.Card,{className:"grid grid-cols-1 @xl:grid-cols-3 bg divide-x mb-8",children:[(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:(0,K.cn)("text-xs shrink-0 font-mono text-foreground-light w-7 h-7 bg border flex items-center justify-center rounded-md"),children:"1"}),(0,s.jsx)("h3",{className:"heading-default",children:"Broadcast messages"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm mb-4 flex-1",children:"Send messages to a channel from your client application or database via triggers."}),(0,s.jsx)(y.Button,{type:"default",className:"w-full",children:(0,s.jsx)(B.default,{href:`/project/${e}/database/triggers`,children:"Create a trigger"})})]}),(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:(0,K.cn)("text-xs shrink-0 font-mono text-foreground-light w-7 h-7 bg border flex items-center justify-center rounded-md"),children:"2"}),(0,s.jsx)("h3",{className:"heading-default",children:"Write policies"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm mb-4 flex-1",children:"Set up Row Level Security policies to control who can see messages within a channel"}),(0,s.jsx)(y.Button,{type:"default",children:(0,s.jsx)(B.default,{href:`/project/${e}/realtime/policies`,children:"Write a policy"})})]}),(0,s.jsxs)("div",{className:"flex flex-col h-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:(0,K.cn)("text-xs shrink-0 font-mono text-foreground-light w-7 h-7 bg border flex items-center justify-center rounded-md"),children:"3"}),(0,s.jsx)("h3",{className:"heading-default",children:"Subscribe to a channel"})]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm mb-4 flex-1",children:"Receive realtime messages in your application by listening to a channel"}),(0,s.jsx)(y.Button,{type:"default",asChild:!0,children:(0,s.jsx)(B.default,{href:`${v.DOCS_URL}/guides/realtime/subscribing-to-database-changes#listening-on-client-side`,children:"Read the guide"})})]})]})]})})},sl=()=>{let{ref:e}=(0,t.useParams)(),{data:o}=(0,r.useSelectedOrganizationQuery)(),{data:c}=(0,i.useSelectedProjectQuery)(),{data:d}=(0,n.useDatabasePublicationsQuery)({projectRef:c?.ref,connectionString:c?.connectionString}),x=(d??[]).find(e=>"supabase_realtime"===e.name),m=!!x&&((x?.tables??[]).length>0||x?.tables===null),[h,u]=(0,a.useState)(!1),[g,p]=(0,a.useState)({enabled:!1,projectRef:e,channelName:"",logLevel:"info",token:"",schema:"public",table:"*",isChannelPrivate:!1,filter:void 0,bearer:null,enablePresence:!0,enableDbChanges:m,enableBroadcast:!0}),{mutate:f}=(0,l.useSendEventMutation)(),{logData:j,sendMessage:b}=((e,s)=>{let{enabled:t,channelName:l,projectRef:n,logLevel:r,token:i,schema:o,table:c,isChannelPrivate:d,filter:x,bearer:m,enablePresence:h,enableDbChanges:u,enableBroadcast:g}=e,{data:p}=(0,e1.useProjectSettingsV2Query)({projectRef:n}),f=p?.app_config?.protocol??"https",j=p?.app_config?.endpoint,b=p?`${f}://${j}`:`https://${n}.supabase.co`,v=`${b}/realtime/v1`.replace(/^http/i,"ws"),[y,N]=(0,a.useReducer)(e4,[]),w=(e,s)=>{N({type:"add",payload:{messageType:e,metadata:s}})},[S,_]=(0,a.useState)(),[C,k]=(0,a.useState)(),R=(0,ev.useRoleImpersonationStateSnapshot)();return(0,a.useEffect)(()=>{if(!t)return;let e=new eZ.default(v,{vsn:"2.0.0",headers:e3,params:{apikey:i,log_level:r}});return m&&e.setAuth(m),_(e),()=>{e.disconnect(),_(void 0)}},[t,m,b,r,i]),(0,a.useEffect)(()=>{if(!S)return;N({type:"clear"});let t=S?.channel(l,{config:{broadcast:{self:!0},private:d}});if(t.on("system",{},e=>{w("SYSTEM",e)}),g&&t.on("broadcast",{event:"*"},e=>w("BROADCAST",e)),h&&t.on("presence",{event:"*"},e=>{w("PRESENCE",e)}),u){let e={event:"*",schema:o,table:c,filter:void 0};""!==x&&(e.filter=x),t.on("postgres_changes",e,e=>{let s=performance.now()+performance.timeOrigin,t=Date.parse(e.commit_timestamp);w("POSTGRES",{...e,latency:s-t})})}return t.subscribe(async(a,l)=>{if("SUBSCRIBED"===a){let e=R.role?.role;if(h){let s=(void 0===e?"service_role_":"anon"===e?"anon_role_":"authenticated"===e?"authenticated_role_":"user_name_")+Math.floor(100*Math.random());t.send({type:"presence",event:"TRACK",payload:{name:s,t:performance.now()}})}}else"CHANNEL_ERROR"===a&&(l?.message?eg.toast.error(`Failed to connect with the following error: ${l.message}`):eg.toast.error("Failed to connect. Please check your RLS policies and try again."),t.unsubscribe(),k(void 0),s({...e,channelName:"",enabled:!1}))}),k(t),()=>{t.unsubscribe(),k(void 0)}},[S,l,g,u,h,x,b,o,c]),{logData:y,sendMessage:(0,a.useCallback)(async(e,s,t)=>{C?"error"===await C.send({type:"broadcast",event:e,payload:s})?eg.toast.error("Failed to broadcast message"):(eg.toast.success("Successfully broadcasted message"),t()):eg.toast.error("Failed to broadcast message: channel has not been set")},[C])}})(g,p);return(0,a.useEffect)(()=>{p(e=>({...e,enableDbChanges:m}))},[m]),(0,s.jsxs)("div",{className:"flex flex-col grow h-full",children:[(0,s.jsx)(eN,{config:g,onChangeConfig:p}),(0,s.jsx)("div",{className:"relative flex flex-col grow",children:(0,s.jsx)("div",{className:"flex grow",children:(j??[]).length>0?(0,s.jsx)(eH,{hasChannelSet:g.channelName.length>0,enabled:g.enabled,data:j,showSendMessage:()=>u(!0)}):(0,s.jsx)(sa,{projectRef:e})})}),(0,s.jsx)(eX,{visible:h,onSelectCancel:()=>u(!1),onSelectConfirm:s=>{f({action:"realtime_inspector_broadcast_sent",groups:{project:e??"Unknown",organization:o?.slug??"Unknown"}}),b(s.message,s.payload,()=>u(!1))}})]})};var sn=e.i(448710),sr=e.i(904340);let si=()=>(0,s.jsx)(sl,{});si.getLayout=e=>(0,s.jsx)(sn.default,{children:(0,s.jsx)(sr.default,{title:"Realtime Inspector",children:e})}),e.s(["InspectorPage",0,si,"default",0,si],399519)},293543,(e,s,t)=>{let a="/project/[ref]/realtime/inspector";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(399519)]),s.hot&&s.hot.dispose(function(){window.__NEXT_P.push([a])})}]);

//# debugId=3837957a-fba4-4fae-d82d-7f1dc8403a90
//# sourceMappingURL=705e57decb289558.js.map